<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
	
	        (        )   (                  (        )          (
	        )\ )  ( /(   )\ )         *   ) )\ )  ( /(          )\ )
	       (()/(  )\()) (()/(    (  ` )  /((()/(  )\())     (  (()/(
	        /(_))((_)\   /(_))   )\  ( )(_))/(_))((_)\      )\  /(_))
	       (_))    ((_) (_))  _ ((_)(_(_())(_))    ((_)  _ ((_)(_))
	       / __|  / _ \ | |  | | | ||_   _||_ _|  / _ \ | | | |/ __|
	       \__ \ | (_) || |__| |_| |  | |   | |  | (_) || |_| |\__ \
	       |___/  \___/ |____|\___/   |_|  |___|  \___/  \___/ |___/
	
	
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<title>Simple Encryption (in Ruby) -- On Deployment, Performance, and Good Natured Tools</title>
  <meta name="keywords" content="deployment,performance,testing,ec2,amazon,cloud computing,ruby,open source" />
	<meta name="description" content="We build the best deployment and testing tools money can't buy. There's no prohibition on performance!" />
	<meta name="author" content="Solutious Inc" />
	<meta name="verify-v1" content="/DvaKRaHTGuNyQBoIP+UgrFycJ+tPfSzWfQIwuKmqMI=" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<link href="/style/screen.css" media="screen" rel="Stylesheet" type="text/css" />
	<link href="/style/print.css" media="print" rel="Stylesheet" type="text/css" />
	<link href="/style/syntax.css" media="screen" rel="Stylesheet" type="text/css" />
	<link href="/blog/atom.rss" rel="alternate" title="The Solutious Blog" type="application/atom+xml" />
  
</head>
<body id="blogPost">

<div id="top">
	<div class="corset">
		<h1 class="logo"><a href="/">Solutious</a></h1>
		<ul class="nav">
			<li class="first"><a href="/about/">about</a></li>
			<li id="navBlog"><a href="/blog/">blog</a></li>
			<li id="navArchive"><a href="/blog/archive/">archive</a></li>
		</ul>
	</div>
</div>



<div class="corset">

<a name="/blog/2008/09/16/simple-ruby-encryption"></a>
<h2><a href="/blog/2008/09/16/simple-ruby-encryption" title="Simple Encryption (in Ruby)">Simple Encryption (in Ruby)</a></h2>

<p class="author">posted by delano on Tue, Sep 16 2008</p>

<!--
<script>
var idcomments_acct = 'defcf13babbc8ef58be95d5511a3b1a1';
var idcomments_post_id;
var idcomments_post_url;
</script>
<script type="text/javascript" src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script>
-->

<p>I occasionally get questions on how we do authentication in Ruby so I thought I&#8217;d write this post so I could direct people here. A lot of the authentication stuff we do is based on this simple implementation of <a href='http://blog.leetsoft.com/2006/03/14/simple-encryption'>RSA key support</a>. There were a couple minor syntax errors in their <a href='http://blog.leetsoft.com/files/crypto-key.rb.txt'>crypto-key.rb</a> though so here&#8217;s a fixed version:</p>
<div class='highlight'><pre><span class='nb'>require</span> <span class='s1'>&#39;openssl&#39;</span> 
<span class='nb'>require</span> <span class='s1'>&#39;base64&#39;</span>	<span class='c1'># Added </span>

<span class='k'>module</span> <span class='nn'>Crypto</span>
  
  <span class='k'>def</span> <span class='nc'>self</span><span class='o'>.</span><span class='nf'>create_keys</span><span class='p'>(</span><span class='n'>priv</span> <span class='o'>=</span> <span class='s2'>&quot;rsa_key&quot;</span><span class='p'>,</span> <span class='n'>pub</span> <span class='o'>=</span> <span class='s2'>&quot;</span><span class='si'>#{</span><span class='n'>priv</span><span class='si'>}</span><span class='s2'>.pub&quot;</span><span class='p'>,</span> <span class='n'>bits</span> <span class='o'>=</span> <span class='mi'>1024</span><span class='p'>)</span>
    <span class='n'>private_key</span> <span class='o'>=</span> <span class='no'>OpenSSL</span><span class='o'>::</span><span class='no'>PKey</span><span class='o'>::</span><span class='no'>RSA</span><span class='o'>.</span><span class='n'>new</span><span class='p'>(</span><span class='n'>bits</span><span class='p'>)</span>
    <span class='no'>File</span><span class='o'>.</span><span class='n'>open</span><span class='p'>(</span><span class='n'>priv</span><span class='p'>,</span> <span class='s2'>&quot;w+&quot;</span><span class='p'>)</span> <span class='p'>{</span> <span class='o'>|</span><span class='n'>fp</span><span class='o'>|</span> <span class='n'>fp</span> <span class='o'>&lt;&lt;</span> <span class='n'>private_key</span><span class='o'>.</span><span class='n'>to_s</span> <span class='p'>}</span>
    <span class='no'>File</span><span class='o'>.</span><span class='n'>open</span><span class='p'>(</span><span class='n'>pub</span><span class='p'>,</span>  <span class='s2'>&quot;w+&quot;</span><span class='p'>)</span> <span class='p'>{</span> <span class='o'>|</span><span class='n'>fp</span><span class='o'>|</span> <span class='n'>fp</span> <span class='o'>&lt;&lt;</span> <span class='n'>private_key</span><span class='o'>.</span><span class='n'>public_key</span><span class='o'>.</span><span class='n'>to_s</span> <span class='p'>}</span>    
    <span class='n'>private_key</span>
  <span class='k'>end</span>
  
  <span class='k'>class</span> <span class='nc'>Key</span>
    <span class='k'>def</span> <span class='nf'>initialize</span><span class='p'>(</span><span class='n'>data</span><span class='p'>)</span>
      <span class='vi'>@public</span> <span class='o'>=</span> <span class='p'>(</span><span class='n'>data</span> <span class='o'>=~</span> <span class='sr'>/^-----BEGIN (RSA|DSA) PRIVATE KEY-----$/</span><span class='p'>)</span><span class='o'>.</span><span class='n'>nil?</span>
      <span class='vi'>@key</span> <span class='o'>=</span> <span class='no'>OpenSSL</span><span class='o'>::</span><span class='no'>PKey</span><span class='o'>::</span><span class='no'>RSA</span><span class='o'>.</span><span class='n'>new</span><span class='p'>(</span><span class='n'>data</span><span class='p'>)</span>
    <span class='k'>end</span>
  
    <span class='k'>def</span> <span class='nc'>self</span><span class='o'>.</span><span class='nf'>from_file</span><span class='p'>(</span><span class='n'>filename</span><span class='p'>)</span>    
      <span class='nb'>self</span><span class='o'>.</span><span class='n'>new</span> <span class='no'>File</span><span class='o'>.</span><span class='n'>read</span><span class='p'>(</span> <span class='n'>filename</span> <span class='p'>)</span>
    <span class='k'>end</span>
  
    <span class='k'>def</span> <span class='nf'>encrypt</span><span class='p'>(</span><span class='n'>text</span><span class='p'>)</span>
      <span class='no'>Base64</span><span class='o'>.</span><span class='n'>encode64</span><span class='p'>(</span><span class='vi'>@key</span><span class='o'>.</span><span class='n'>send</span><span class='p'>(</span><span class='s2'>&quot;</span><span class='si'>#{</span><span class='n'>key_type</span><span class='si'>}</span><span class='s2'>_encrypt&quot;</span><span class='p'>,</span> <span class='n'>text</span><span class='p'>))</span>
    <span class='k'>end</span>
    
    <span class='k'>def</span> <span class='nf'>decrypt</span><span class='p'>(</span><span class='n'>text</span><span class='p'>)</span>
      <span class='vi'>@key</span><span class='o'>.</span><span class='n'>send</span><span class='p'>(</span><span class='s2'>&quot;</span><span class='si'>#{</span><span class='n'>key_type</span><span class='si'>}</span><span class='s2'>_decrypt&quot;</span><span class='p'>,</span> <span class='no'>Base64</span><span class='o'>.</span><span class='n'>decode64</span><span class='p'>(</span><span class='n'>text</span><span class='p'>))</span>
    <span class='k'>end</span>
  
 <span class='k'>def</span> <span class='nf'>private?</span><span class='p'>()</span>  <span class='o'>!</span><span class='vi'>@public</span><span class='p'>;</span> <span class='k'>end</span> <span class='c1'># Added () and ;</span>

 <span class='k'>def</span> <span class='nf'>public?</span><span class='p'>()</span>   <span class='vi'>@public</span><span class='p'>;</span>  <span class='k'>end</span> <span class='c1'># Added () and ;</span>
    
    <span class='k'>def</span> <span class='nf'>key_type</span>
      <span class='vi'>@public</span> <span class='p'>?</span> <span class='ss'>:public</span> <span class='p'>:</span> <span class='ss'>:private</span>
    <span class='k'>end</span>
  <span class='k'>end</span>
<span class='k'>end</span>
</pre></div>

<div id="related">
  <h3>Related Posts</h3>
  <ul class="posts">
    
      <li><span>Apr 30 2009</span> &raquo; <a href="/blog/2009/04/30/its-an-outrake">It's an outrake!</a></li>
    
      <li><span>Apr 21 2009</span> &raquo; <a href="/blog/2009/04/21/rudy-not-your-grandparents-deployment-tool">Rudy, not your grandparent's deployment tool</a></li>
    
      <li><span>Dec 10 2008</span> &raquo; <a href="/blog/2008/12/10/using-amazon-ec2-in-europe">Using Amazon EC2 In Europe</a></li>
    
  </ul>
</div>

<script>
var idcomments_acct = 'defcf13babbc8ef58be95d5511a3b1a1';
var idcomments_post_id;
var idcomments_post_url;
</script>
<span id="IDCommentsPostTitle" style="display:none"></span>
<script type='text/javascript'
src='http://www.intensedebate.com/js/genericCommentWrapperV2.js'></script>


</div>
  

<div id="footer" class="corset">
	<a href="http://solutious.com/" class="big">Solutious</a>.
	<span class="tagline">There's no prohibition on performance.</span>
	Copyright 2006-2009.
</div>
 	
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-4642735-3");
pageTracker._trackPageview();
</script>


</body>
</html>

