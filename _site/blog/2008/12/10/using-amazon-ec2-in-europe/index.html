<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
	
	        (        )   (                  (        )          (
	        )\ )  ( /(   )\ )         *   ) )\ )  ( /(          )\ )
	       (()/(  )\()) (()/(    (  ` )  /((()/(  )\())     (  (()/(
	        /(_))((_)\   /(_))   )\  ( )(_))/(_))((_)\      )\  /(_))
	       (_))    ((_) (_))  _ ((_)(_(_())(_))    ((_)  _ ((_)(_))
	       / __|  / _ \ | |  | | | ||_   _||_ _|  / _ \ | | | |/ __|
	       \__ \ | (_) || |__| |_| |  | |   | |  | (_) || |_| |\__ \
	       |___/  \___/ |____|\___/   |_|  |___|  \___/  \___/ |___/
	
	
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<title>Solutious, The Performance Company.</title>
  <meta name="keywords" content="deployment,performance,testing,ec2,amazon,cloud computing,ruby,open source" />
	<meta name="description" content="We build the best deployment and testing tools money can't buy. There's no prohibition on performance!" />
	<meta name="author" content="Solutious Inc" />
	<meta name="verify-v1" content="/DvaKRaHTGuNyQBoIP+UgrFycJ+tPfSzWfQIwuKmqMI=" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<link href="/style/screen.css" media="screen" rel="Stylesheet" type="text/css" />
	<link href="/style/print.css" media="print" rel="Stylesheet" type="text/css" />
	<script src="/script/sifr.js" type="text/javascript"></script>
	<script src="/script/script.js" type="text/javascript"></script>	
</head>
<body class="blog">

	<div class="corset">
		<div class="top">
			<div class="openSourceProjects">Open Source Projects</div>
			<a class="logo" href="/"><h1>Solutious</h1></a>

			<ul class="productNav">
				<!--li class="ceasars"><a href="#">Ceasars</a></li>
				<li class="drydock"><a href="#">Drydock</a></li-->
				<li class="stella"><a href="/stella">Stella</a></li>
				<li class="rudy"><a href="/rudy">Rudy</a></li>
			</ul>
			
			<ul class="navLeftLine"><li>&nbsp;</li></ul>
			<ul class="nav">
				<li class="navHome first"><a href="/">HOME</a></li>
				<li class="navAbout"><a href="/">ABOUT</a></li>
				<!--li class="navProducts"><a href="/products">PRODUCTS</a></li-->
				<li class="navBlog"><a href="/blog">BLOG</a></li>
				<!--li class="navContact"><a href="/">CONTACT</a></li-->
			</ul>

			<div class="subnav">
				<div class="message">welcome to solutious - we like icecream and yamalows</div>
				<ul>
					<li class="navArchive first"><a href="archive">archives</a></li>
				</ul>
			</div>	
		</div>


	<div class="left">
	
<div class="entry">

	<div class="info">
		<div class="month">Dec '08</div>
		<div class="day">10</div>
		<!--div class="commentCount">122</div-->
	</div>

	<a href="/blog/2008/12/10/using-amazon-ec2-in-europe" title="Using Amazon EC2 In Europe"><h2>Using Amazon EC2 In Europe</h2></a>
	<p class="author">posted by </p>

<!--
<script>
var idcomments_acct = 'defcf13babbc8ef58be95d5511a3b1a1';
var idcomments_post_id;
var idcomments_post_url;
</script>
<script type="text/javascript" src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script>
-->

<p>If you're worked with EC2 before, there are a couple things you need to know to get started with launching machine instances in Europe. SSH Keys and AMIs are not shared between regions. We're going to create both of these and then launch an instance in Europe. There's also a new parameter <code>--region</code> which you need to use to interact with the new availability zones. Let's giver'.</p>

<h2>Create an S3 bucket in Europe</h2>

<p>AMIs are stored in S3 so you need a bucket in Europe if you don't have one already (you'll probably want a new one for your machine images anyway). There's a Firefox extension called <a href="https://addons.mozilla.org/en-US/firefox/addon/3247">S3Fox</a> that can help you do this (check the box labeled, "Place this bucket in Europe"). Note that S3Fox is quirky and ugly almost to the point where it's offensive. But it works and it's easier than writing a script. The free version of <a href="http://rightscale.com/">RightScale</a> can do this too. You can also use <a href="http://s3tools.logix.cz/s3tools">S3Tools</a> to create buckets but I've never used them so I can't recommend them.<br/>
</p>

<h2>Copy an AMI from the US to EU</h2>

<p>You have two choices: re-bundle your running instance(s) or copy your existing images with the <code>ec2-migrate-bundle</code> tool. If you choose to re-bundle, follow the steps you normally would (described in the <a href="http://docs.amazonwebservices.com/AWSEC2/2008-12-01/DeveloperGuide/index.html?bundling-an-ami-linux.html">developer guide</a>) and then upload the bundle to Europe (also in the <a href="http://docs.amazonwebservices.com/AWSEC2/2008-12-01/DeveloperGuide/index.html?CLTRG-ami-upload-bundle.html">developer guide</a>).</p>

<p>The easiest approach is to use the <code>ec2-migrate-bundle</code> tool. You'll need to install the latest <a href="http://developer.amazonwebservices.com/connect/entry.jspa?externalID=368">AMI tools</a> to a Linux or Windows machine near you (these <em><a href="http://developer.amazonwebservices.com/connect/message.jspa?messageID=92712">will not work on OSX</a></em>). As a side note, the AMI tools are written in Ruby which is interesting because the <a href="http://developer.amazonwebservices.com/connect/entry.jspa?externalID=351">API tools</a> are written in Java.</p>

<pre><code>$ ec2-migrate-bundle --location EU --cert /mnt/cert-*.pem --privatekey /mnt/pk-*.pem \
--access-key ORANGEJUICE --secret-key SUp0rS3kRu7 \
--bucket BUCKET-IN-US --destination-bucket BUCKET-IN-EU \ 
--manifest IMAGE.manifest.xml 
</code></pre>

<p>Note: If you're running this command on an EC2 instance, you'll need to upload your encryption keys first:</p>

<pre><code>$ scp -i PATH/2/private-key PATH/2/cert-*.pem PATH/2/pk-*.pem root@YOURMACHINE:/mnt/
</code></pre>

<p>From your local machine, run the follow to tell EC2 that your new Europe image exists:</p>

<pre><code>$ ec2-register --region eu-west-1 BUCKET-IN-EU/IMAGE.manifest.xml
</code></pre>

<h2>Update API Tools</h2>

<p>You won't be able to see your image yet b/c you need to update your <a href="http://developer.amazonwebservices.com/connect/entry.jspa?externalID=351">API tools</a>. You should run these on a <em>real, physical machine</em>. Why? Because it's a good rule of thumb for keeping your keys secure. If you copy them to a machine instance, you could forget them and they could end up being available on every instance you startup.</p>

<p>Now you'll be able to see your machine images in Europe:</p>

<pre><code>$ ec2-describe-images --region eu-west-1 -o self
</code></pre>

<p>You'll be able to see the regions and availability zones:</p>

<pre><code>$ ec2-describe-regions
REGION  eu-west-1   eu-west-1.ec2.amazonaws.com
REGION  us-east-1   us-east-1.ec2.amazonaws.com

$ ec2-describe-availability-zones --region eu-west-1
AVAILABILITYZONE    eu-west-1a   available  eu-west-1
AVAILABILITYZONE    eu-west-1b   available  eu-west-1
</code></pre>

<p>You can make Europe your default region by adding the <code>EC2_URL</code> variable to your environment:</p>

<pre><code># Unix and Unix-like:
export EC2_URL=https://eu-west-1.ec2.amazonaws.com

# Windows:
set EC2_URL=https://eu-west-1.ec2.amazonaws.com
</code></pre>

<h2>Create an SSH key in Europe</h2>

<p>Before you can launch an instance in Europe, you need to create a new SSH key:</p>

<pre><code>$ ec2-add-keypair eu-west-1-key --region eu-west-1
</code></pre>

<p>The output of this command is your private key. Save it in a secure location! You'll need to make sure it's only readable by you (<code>chmod 600 eu-west-1-key</code>). SSH won't use it otherwise.</p>

<h2>Create a security group in Europe</h2>

<p>The default security group won't allow you to SSH in to your new instance. You can create a new group with these commands:</p>

<pre><code>$ ec2-add-group --region eu-west-1 -d "Potato Storage" potato
GROUP   potato  Potato Storage

$ ec2-authorize --region eu-west-1 -p 22 potato
GROUP       potato  
PERMISSION      potato  ALLOWS  tcp 22  22  FROM    CIDR    0.0.0.0/0
</code></pre>

<p>If security groups are new to you, be sure to check out the <a href="http://docs.amazonwebservices.com/AWSEC2/2008-12-01/DeveloperGuide/index.html?CLTRG-ami-migrate-bundle.html">documentation</a> and <a href="http://docs.amazonwebservices.com/AmazonEC2/dg/2006-10-01/distributed-firewall-examples.html">firewall examples</a>. <a href="http://broadcast.oreilly.com/2008/11/20-rules-for-amazon-cloud-security.html">Twenty Rules for Amazon Cloud Security</a> is a good read too.</p>

<h2>Launch an instance in Europe (finally!)</h2>

<pre><code>$ ec2-run-instances --region eu-west-1 --availability-zone eu-west-1b \
--key eu-west-1-key --group potato -t m1.small ami-XXXXXXXX
</code></pre>

<p>Use the following command to see when it becomes available:</p>

<pre><code>$ ec2-describe-instances --region eu-west-1
</code></pre>

<p>Once it does, log in and have some fun!</p>

<pre><code>$ ssh -i PATH/2/eu-west-1-key root@ec2-XX-XXX-XX-XXX.eu-west-1.compute.amazonaws.com
</code></pre>

<h2>Don't forget to terminate the instance!</h2>

<pre><code>$ ec2-terminate-instances --region eu-west-1 i-XXXXXXXX
</code></pre>

<h2>Extra Stuff</h2>

<p>There's more information about regions in the <a href="http://developer.amazonwebservices.com/connect/entry.jspa?externalID=1927&amp;categoryID=174">Amazon EC2 Regions Guide</a>.</p>

<p>Enjoy running your apps in style!</p>


<div id="related">
  <h3>Related Posts</h3>
  <ul class="posts">
    
      <li><span>Apr 21 2009</span> &raquo; <a href="/blog/2009/04/21/rudy-not-your-grandparents-deployment-tool">Rudy, not your grandparent's deployment tool</a></li>
    
      <li><span>Apr 22 2009</span> &raquo; <a href="/blog/2009/04/22/rudy-ec2-api-tools-replacement">Rudy, A Replacement for EC2 API Tools.</a></li>
    
      <li><span>Sep 23 2008</span> &raquo; <a href="/blog/2008/09/23/ec2-disk-performance-linux-solaris">EC2 Disk Performance, Linux vs OpenSolaris - Preliminary Results</a></li>
    
  </ul>
</div>

<script>
var idcomments_acct = 'defcf13babbc8ef58be95d5511a3b1a1';
var idcomments_post_id;
var idcomments_post_url;
</script>
<span id="IDCommentsPostTitle" style="display:none"></span>
<script type='text/javascript'
src='http://www.intensedebate.com/js/genericCommentWrapperV2.js'></script>


</div>
	</div>
	
	<div class="aboutSolutious">
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam a mauris. Aenean fringilla, leo non ornare condimentum, tellus leo condimentum arcu, ac commodo tortor augue at justo. Praesent vehicula. Nam tellus. Proin in erat quis augue elementum ullamcorper. Phasellus sodales egestas augue. Sed odio dolor, aliquet ac, pellentesque sit amet, eleifend non, risus. Fusce ornare nunc eget leo. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos.</p>
			<p class="signature">- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Solutious</p>
	</div>

	<div class="aboutDelano">
		<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam a mauris. Aenean fringilla, leo non ornare condimentum, tellus leo condimentum arcu, ac commodo tortor augue at justo. Praesent vehicula. Nam tellus. Proin in erat quis augue elementum ullamcorper. Phasellus sodales egestas augue. Sed odio dolor, aliquet ac, pellentesque sit amet, eleifend non, risus. Fusce ornare nunc eget leo. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos.</p>
		<p class="signature">- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Delano Mandelbaum</p>
	</div>
	<div class="reset"></div>

	<div id="footer">
		<a href="http://solutious.com/" class="big">Solutious</a>.
		<span class="tagline">There's no prohibition on performance.</span>
		Copyright 2006-2009.
	</div>
	
</div>
 	
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-4642735-3");
pageTracker._trackPageview();
</script>


</body>
</html>

