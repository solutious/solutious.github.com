<html><head><title>RubyGems 1/30/13 Incident Status</title><style type="text/css">ol{margin:0;padding:0}.c12{list-style-type:lower-roman;margin:0;padding:0}.c14{list-style-type:lower-latin;margin:0;padding:0}.c15{list-style-type:decimal;margin:0;padding:0}.c3{list-style-type:circle;margin:0;padding:0}.c8{list-style-type:disc;margin:0;padding:0}.c5{list-style-type:square;margin:0;padding:0}.c7{padding-left:0pt;margin-left:72pt}.c9{padding-left:0pt;margin-left:108pt}.c2{color:inherit;text-decoration:inherit}.c13{font-size:10pt;font-style:italic}.c6{padding-left:0pt;margin-left:36pt}.c4{color:#1155cc;text-decoration:underline}.c20{max-width:468pt;padding:72pt 72pt 72pt 72pt}.c17{font-size:14pt}.c19{font-style:italic}.c11{background-color:#ffffff}.c0{direction:ltr}.c1{height:11pt}.c16{font-size:10pt}.c18{font-size:18pt}.c21{text-decoration:line-through}.c10{font-weight:bold}.title{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:36pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}.subtitle{padding-top:18pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:24pt;font-family:"Georgia";padding-bottom:4pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:18pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}h2{padding-top:18pt;line-height:1.15;text-align:left;color:#000000;font-size:14pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h3{padding-top:14pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h4{padding-top:12pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Arial";padding-bottom:2pt}h5{padding-top:11pt;line-height:1.15;text-align:left;color:#666666;font-size:10pt;font-family:"Arial";font-weight:bold;padding-bottom:2pt}h6{padding-top:10pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:10pt;font-family:"Arial";padding-bottom:2pt}</style></head><body class="c11 c20">
<p><em><a href="https://docs.google.com/document/d/10tuM51VKRcSHJtUZotraMlrMHWK1uXs8qQ6Hmguyf1g/edit">This was was mirrored on Feb 6, 2013</a></em></p>
<p class="c0"><span class="c10 c18">RubyGems 1/30/13 Incident Status</span></p><p class="c0 c1"><span></span></p><p class="c0"><span>Hi everyone! We&rsquo;re using this Google Doc as a live way to update folks outside of our existing status site (also it keeps changes/history pretty well).</span></p><p class="c0 c1"><span></span></p><p class="c0"><span>All of this is going on in #rubygems on irc.freenode.net (and several sub-rooms). If you want to help out, join in. </span><span class="c10">RubyGems is a volunteer-run service. </span></p><p class="c0 c1"><span class="c10"></span></p><p class="c0"><span>For current status on what services are up, please check </span><span class="c4"><a class="c2" href="http://status.rubygems.org/">http://status.rubygems.org/</a></span><span>&nbsp;</span></p><p class="c0 c1"><span></span></p><p class="c0"><span>Gem downloads are available and every gem installable by `gem install` has been verified by one or more SHA512 checksums. No gems were altered during the exploit.</span></p><p class="c0 c1"><span></span></p><p class="c0"><span class="c10">Need to push a new gem? Use Bundler&rsquo;s git option until the Push API is back: </span><span class="c4 c10"><a class="c2" href="http://gembundler.com/git.html">http://gembundler.com/git.html</a></span><span class="c10">&nbsp;</span></p><h3 class="c0"><a name="h.pitnpiqy1rkt"></a><span>1 February 2013</span></h3><p class="c0"><span>As of 2:05AM EST: (Eric Hodel)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>We&rsquo;ve verified all but 13689 gems, all prerelease versions, with 2 or more third-party hashes. This verification reduces the likelihood of collusion between the person who exploited rubygems.org and one of the submitted sets of SHA512 checksums.</span></li><li class="c6 c0"><span>See </span><span class="c4"><a class="c2" href="https://github.com/rubygems/rubygems-verification">https://github.com/rubygems/rubygems-verification</a></span><span>&nbsp;for data and scripts used in all rubygems verifications.</span></li></ol><h3 class="c0"><a name="h.3hve21nzanad"></a><span>31 January 2013</span></h3><p class="c0 c1"><span></span></p><p class="c0"><span>As of 8:50PM EST: (Eric Hodel)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>We&rsquo;re still working to set up a new rubygems.org host on AWS. &nbsp;Currently we&#39;re tuning postgres, configuring loadbalancers and auditing access rules </span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 6:55PM EST: (Eric Hodel)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>The S3 logs have been checked and there have been zero duplicate PUT requests for gems, so no existing gem was overwritten by the exploit.</span></li><li class="c6 c0"><span>The 80 prerelease gems that had not been verified have been yanked.</span></li><li class="c6 c0"><span>All gems on S3 that are downloadable through `gem install` have been verified against at least one third-party mirror with SHA512 checksums.</span></li><li class="c6 c0"><span>At some point in the future we will delete the remaining unverified but uninstallable gems from S3.</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 6:40PM EST: (Eric Hodel)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>All but 80 prerelease gems have been verified. Except for these 80 gems the gems from the unverified list had been yanked and were not installable by `gem install` or through bundler. The gems in the unverified list posted below in the </span><span class="c10">Notes</span><span>&nbsp;section will be yanked and the authors of those gems will be notified by email.</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 4:00PM EST: (Brad Landers)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>Clarification for rubygems users: the old rubygems.org infrastructure is not in use. The API is not actually online, even though you are still able to install gems. Workarounds are in place that allow this to happen, but the old infrastructure and app are offline. The actual gem files continue to be hosted on Amazon S3 (same as always).</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 3:05PM EST: (Mark Imbriaco)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>Yesterday all gems were downloaded and checked for YAML exploits in their metadata and no odd &ldquo;!ruby&rdquo; payloads were found: </span><span class="c4"><a class="c2" href="https://gist.github.com/fd090905e322c44148b9">https://gist.github.com/fd090905e322c44148b9</a></span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 2:45PM EST: (Eric Hodel)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>The unverified list from 2:15PM EST was incorrectly generated and excluded gems with a mismatched checksum from any of the mirrors. &nbsp;This has been corrected. &nbsp;The difference was 49 gems.</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 2:35PM EST: (Eric Hodel for evan)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>Red Hat security teams helped with forensics analysis on the server:</span></li></ol><ol class="c3" start="1"><li class="c7 c0"><span>The server was well-patched</span></li><li class="c7 c0"><span>No evidence of tampering with processes was found</span></li><li class="c7 c0"><span>No evidence of shell access was found</span></li><li class="c7 c0"><span>No evidence of running commands was found</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 2:15PM EST: (Eric Hodel)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>Updated the unverified list at </span><span class="c4"><a class="c2" href="https://gist.github.com/4685276">https://gist.github.com/4685276</a></span><span>&nbsp;to include terrcin&rsquo;s Railscamp NZ mirror</span></li><li class="c6 c0"><span>The list now has 5.8% of gems unverified by at least one mirror</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 2:00PM EST: (Eric Hodel)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>This list of hashes has gems that have not been verified by at least one mirror: </span><span class="c4"><a class="c2" href="https://gist.github.com/4685276">https://gist.github.com/4685276</a></span></li><li class="c6 c0"><span>This list leaves 9.8% of gems unverified by at least one mirror</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 12:40PM EST: (qrush)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>Waiting on west coast gem verifiers to wake up and confirm work done.</span></li><li class="c6 c0"><span>Infrastructure team has started spinning up instances and testing out provisioning</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 9:40AM EST: (qrush)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>We are still working to verify 100% of the gems. </span></li><li class="c6 c0"><span>New infrastructure work has really come together at </span><span class="c4"><a class="c2" href="https://github.com/rubygems/rubygems-aws">https://github.com/rubygems/rubygems-aws</a></span><span>&nbsp;- hoping to deploy soon!</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 3:15AM EST:(Eric Hodel/raggi)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>The Heroku checksum set (built from heroku application caches between late November 2012 and 21 January 2013 at midnight UTC containing 17496 checksums) verified an additional 710 gems that were not verified by the Automatic Labs or Blue Box sets. This is 0.2% of gems. Currently 90% of gems match S3 with two or more mirrors.</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 2:00AM EST: (Eric Hodel/raggi)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>Automatic Labs mirror checksums match the Blue Box mirror checksums giving 90% coverage with two mirrors except for 50 gems in the Automatic Labs checksums</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 1:10AM EST: (Eric Hodel/raggi)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>The gem with a mismatched checksum from the Blue Box has been checked and verified.</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 12:00AM EST: (qrush)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>Infrastructure work is coming along nicely at </span><span class="c4"><a class="c2" href="https://github.com/rubygems/rubygems-aws">https://github.com/rubygems/rubygems-aws</a></span><span>&nbsp;</span></li><li class="c6 c0"><span>Some potential workarounds for the YAML vulnerability on rubygems.org&rsquo;s Gem::Specification loading have been proposed and patches are coming together.</span></li></ol><h3 class="c0"><a name="h.d6tpt8a4szeu"></a><span>30 January 2013</span></h3><p class="c0 c1"><span></span></p><p class="c0"><span>As of 11:40PM EST: (Eric Hodel/raggi)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>Verified gems against the Blue Box mirror with 90% of gems matching, the remaining 10% are missing with the exception of one gem with a mismatch due to an incomplete cache. This list cross-checks with the AT&amp;T list. The sha512 sum list here: </span><span class="c4"><a class="c2" href="https://gist.github.com/8db00eea60c8d99d2bfb">https://gist.github.com/8db00eea60c8d99d2bfb</a></span></li></ol><p class="c0 c1"><span class="c10"></span></p><p class="c0"><span>As of 11:30PM EST: (qrush)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>Status site is fixed, please check that for individual up/down status checks</span></li><li class="c6 c0"><span>Individual gem pages are redirecting to static index.html site now</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 11:00PM EST: (qrush)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="3"><li class="c6 c0"><span>Status site is reporting incorrect information since the index.html was put in place. Looking into fixing it.</span></li></ol><p class="c0 c1"><span class="c10"></span></p><p class="c0"><span>As of 10:30PM EST: (qrush)</span></p><p class="c0 c1"><span class="c10"></span></p><ol class="c8" start="1"><li class="c6 c0"><span>Chef &amp; Verification work continues</span></li><li class="c6 c0"><span>Looking into the exploit gem has started</span></li><li class="c6 c0"><span>Maintenance page replaced with static index.html served off frontend boxes on Rackspace</span></li><li class="c6 c0"><span>Individual gem pages are 404&rsquo;ing right now (</span><span class="c4"><a class="c2" href="http://rubygems.org/gems/rails">http://rubygems.org/gems/rails</a></span><span>), looking into fixing this on frontends</span></li></ol><p class="c0 c1"><span class="c10"></span></p><p class="c0"><span>As of 10:00PM EST: (qrush)</span></p><p class="c0 c1"><span class="c10"></span></p><ol class="c8" start="5"><li class="c6 c0"><span>Chef work continues</span></li><li class="c6 c0"><span>More verification work continues</span></li><li class="c6 c0"><span>Almost ready with index.html for frontend boxes</span></li><li class="c6 c0"><span>From Heroku - &ldquo;The RubyGems team has verified that about 84% of all gems stored at RubyGems are unmodified. An external 2-month old mirror was used for the verification, and the gap is due to gems pushed in the last two months. A second mirror is currently being used to cover the remaining 16%.&rdquo;</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 9:30PM EST: (qrush)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>Verification work continues with BlueBox and other friendly folks</span></li><li class="c6 c0"><span>Working on getting an index.html page up on the frontend Rackspace boxes (that were not compromised), and then going to redirect</span></li><li class="c6 c0"><span class="c21">Status site still blocked thanks to messed up Heroku deploy</span><span>&nbsp;FIXED! Thanks @tmaher.</span></li><li class="c6 c0"><span>84% of gems verified against AT&amp;T mirror which was last updated end of November 2012 (around the 26th)</span></li></ol><p class="c0"><span><br>As of 9:00PM EST: (qrush)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="5"><li class="c6 c0"><span>Site is still pointed to Rackspace (but no requests are being served from the compromised box)</span></li><li class="c6 c0"><span>Several BlueBox engineers have come to help with verifying gems. Thanks!!</span></li><li class="c6 c0"><span>Status site can&rsquo;t be updated easily on Heroku, so tweeted this doc out and going to keep using it.</span></li><li class="c6 c0"><span>Google hangout has started for AWS move</span></li><li class="c6 c0"><span>Fix is still pending for the original YAML vulnerability in the Rails app</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As </span><span>of 8:30PM EST: (qrush)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>The site is in maintenance mode.</span></li><li class="c6 c0"><span>We need to spin down the compromised &ldquo;backend&rdquo; machine on Rackspace still.</span></li><li class="c6 c0"><span>We are working on updating the status site since it&rsquo;s been pretty broken</span></li><li class="c6 c0"><span>A team is working on verifying all known gems on production.s3.rubygems.org to ensure none have been tampered with. Chances of this are extremely small (See below). Results will be published soon, hopefully.</span></li><li class="c6 c0"><span>A team is working on setting up proper infrastructure with Chef on AWS to replace our existing hand-rolled infrastructure on Rackspace.</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 6:30PM EST: (bradland)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>Rubygems team verify that S3 logs show no PUTs from hosts other than the production server or developer laptops; verification that S3 credentials were not used &ldquo;in the wild&rdquo;.</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 3:00PM EST: (qrush)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>GitHub and Heroku recommend to stop deploys until all gems can be verified: https://twitter.com/heroku/status/296693401573797889</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 12:00PM EST: (evan)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="2"><li class="c0 c6"><span>Auditing and verification of gems begins in #rubygems on freenode</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 11:00AM EST: (qrush/evan)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>Site brought back up without Push API</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 9:45 AM EST: &nbsp;(qrush/evan)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>Put site into maintenance mode</span></li><li class="c6 c0"><span>S3 keys reset, SECRET_TOKEN reset</span></li><li class="c6 c0"><span>Exploit gems deleted from database and purged from S3</span></li></ol><p class="c0 c1"><span></span></p><p class="c0"><span>As of 9:30 AM EST: (bradland)</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>Link to &ldquo;exploit&rdquo; gem (that&rsquo;s literally the name) posted to </span><span class="c4"><a class="c2" href="http://news.ycombinator.com/item?id=5139583">Hacker News</a></span></li></ol><h2 class="c0"><a name="h.2l3op22wjp6v"></a><span>IRC channels on Freenode</span></h2><p class="c0"><span>#rubygems Central conversation</span></p><p class="c0"><span>#rubygems-verification: Verifying checksums against S3</span></p><p class="c0"><span>#rubygems-aws: Rebuilding the site on a new host</span></p><p class="c0"><span>#rubygems-exploit: Patching rubygems-org app</span></p><h2 class="c0"><a name="h.mwa17r4sk5qv"></a><span>How to help</span></h2><p class="c0"><span>Assistance is greatly appreciated. Most of the effort is being coordinated by an ongoing conversation in IRC #rubygems. Please take a moment to read the message backlog before flooding the channel. Currently, there is a lot of effort going on in verifying gems across many sources. You can help by:</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>Validating your gems</span></li></ol><ol class="c3" start="1"><li class="c7 c0"><span>View this gist and grab one of the validators from the &ldquo;Notes&rdquo;, &ldquo;Important links&rdquo; section below</span></li><li class="c7 c0"><span>Validate your local gems</span></li><li class="c7 c0"><span>Comment on that gist with any discrepancies</span></li><li class="c7 c0"><span>Join #rubygems-verification if you have data</span></li></ol><ol class="c8" start="2"><li class="c6 c0"><span>Contact someone on IRC in #rubygems-verification if you know of a gem mirror/cache with a significant (thousands or more) number of gems</span></li></ol><ol class="c3" start="1"><li class="c7 c0"><span>We already have Heroku, Blue Box and Rubyforge, thx!</span></li></ol><h4 class="c0"><a name="h.brkli320j3a4"></a><span>What&rsquo;s happening right now</span></h4><ol class="c8" start="1"><li class="c6 c0"><span>Rebuild of rubygems.org infrastructure (new home) on AWS us-west</span></li><li class="c6 c0"><span>Verification of .gem files from as many sources as possible</span></li><li class="c6 c0"><span>Assessment of core vulnerability</span></li></ol><h2 class="c0"><a name="h.xi14k5f4cfdk"></a><span>Official status info</span></h2><ol class="c8" start="1"><li class="c6 c0"><span>Canonical: </span><span class="c4"><a class="c2" href="http://status.rubygems.org">http://status.rubygems.org</a></span><span>&nbsp;</span></li><li class="c6 c0"><span>Twitter: </span><span class="c4"><a class="c2" href="https://twitter.com/rubygems_status">https://twitter.com/rubygems_status</a></span><span>&nbsp;</span></li></ol><h2 class="c0"><a name="h.i7mwinjt1g9t"></a><span>Notes</span></h2><h4 class="c0"><a name="h.nsi7yfjbj6v"></a><span>Important links:</span></h4><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>See </span><span class="c4"><a class="c2" href="https://github.com/rubygems/rubygems-verification">https://github.com/rubygems/rubygems-verification</a></span><span>&nbsp;for a list of a list of SHA512 checksums and tools used to verify the gems on S3. This contains data and scripts mentioned below.</span></li></ol><ol class="c8" start="1"><li class="c6 c0"><span>Rubygems S3 .gem file list list: </span><span class="c4"><a class="c2" href="http://spy.infr.as/all-gems.txt">http://spy.infr.as/all-gems.txt</a></span></li></ol><ol class="c3" start="1"><li class="c7 c0"><span>Entire list has been grepped by benchMark (mark imbriaco) for !ruby invocations (clean)</span></li></ol><ol class="c8" start="2"><li class="c6 c0"><span>.gem file checksums</span></li></ol><ol class="c3" start="1"><li class="c7 c0"><span>Unverified list (SHA512): </span><span class="c4"><a class="c2" href="https://gist.github.com/4685276">https://gist.github.com/4685276</a></span><span>&nbsp;</span><span class="c13">This list is updated as new checksums are created. Check the Revisions for the last update</span></li><li class="c7 c0"><span>RubyGems (MD5): </span><span class="c4"><a class="c2" href="http://cl.ly/MY8P">http://cl.ly/MY8P</a></span></li><li class="c7 c0"><span>RubyGems (SHA512): </span><span class="c4"><a class="c2" href="http://cl.ly/MYie">http://cl.ly/MYie</a></span></li><li class="c7 c0"><span class="c11">RubyForge (MD5): </span><span class="c4"><a class="c2" href="https://gist.github.com/69c89387c6c3bfcf8719">https://gist.github.com/69c89387c6c3bfcf8719</a></span></li><li class="c7 c0"><span>AT&amp;T Mirror (SHA512): </span><span class="c4"><a class="c2" href="https://gist.github.com/4679063">https://gist.github.com/4679063</a></span><span>&nbsp;<br></span><span class="c13 c11">does not include prereleases or the last 2 months</span></li><li class="c7 c0"><span>Blue Box Mirror (MD5): </span><span class="c4"><a class="c2" href="https://gist.github.com/f9c4e5cf78aee261ad48">https://gist.github.com/f9c4e5cf78aee261ad48</a></span></li><li class="c7 c0"><span>Blue Box Mirror (SHA512): </span><span class="c4"><a class="c2" href="https://gist.github.com/8db00eea60c8d99d2bfb">https://gist.github.com/8db00eea60c8d99d2bfb</a></span><span>&nbsp;</span><span class="c13">mismatch omg_validator-1.0.0.gem was separately validated as OK </span></li><li class="c7 c0"><span>Automated Labs Mirror (SHA512): </span><span class="c4"><a class="c2" href="https://gist.github.com/4680849">https://gist.github.com/4680849</a></span><span>&nbsp;contains 50 </span><span class="c13">mismatches which also mismatch against the Blue Box checksums</span></li><li class="c7 c0"><span>Heroku (SHA512) </span><span class="c4"><a class="c2" href="https://gist.github.com/4681280">https://gist.github.com/4681280</a></span><span>&nbsp;</span><span class="c19">f</span><span class="c13">rom application caches built between late November 2012 and 21 January 2013, some gems have multiple hashes</span></li><li class="c7 c0"><span>Mirror generated by terrcin for NZ Railscamp (SHA512) </span><span class="c4"><a class="c2" href="https://gist.github.com/4685502">https://gist.github.com/4685502</a></span></li><li class="c7 c0"><span>Google third-party depot (SHA512): </span><span class="c4"><a class="c2" href="https://gist.github.com/raw/c23588f19b7171247bb2/f963d04c31c078df45fd341ea15edf79def0449f/google3rd-shas">https://gist.github.com/raw/c23588f19b7171247bb2/f963d04c31c078df45fd341ea15edf79def0449f/google3rd-shas</a></span></li><li class="c7 c0"><span>Tokyo RubyGems Mirror (SHA512): </span><span class="c4"><a class="c2" href="https://gist.github.com/raw/d1a5316e4b8522e09e15/60ec496eca44ba139c3315452089eceaae7c0321/tkm-shas">https://gist.github.com/raw/d1a5316e4b8522e09e15/60ec496eca44ba139c3315452089eceaae7c0321/tkm-shas</a></span></li><li class="c7 c0"><span>Google &ldquo;ghost&rdquo; (SHA512): </span><span class="c4"><a class="c2" href="https://gist.github.com/raw/f8cdb4d40197ee28670b/7cf4f14e79d97318198a7b3df1153d079c7b2aaf/ghost-shas">https://gist.github.com/raw/f8cdb4d40197ee28670b/7cf4f14e79d97318198a7b3df1153d079c7b2aaf/ghost-shas</a></span></li></ol><ol class="c8" start="3"><li class="c6 c0"><span>Gem SHA comparison tool: </span><span class="c4">http</span><span class="c4"><a class="c2" href="https://gist.github.com/e4cb74f17d7a995d32e8">s://gist.github.com/e4cb74f17d7a995d32e8</a></span><span><br><br>This tool is used to compare the RubyGems SHA512 list above against the mirror SHA512 checksums below. &nbsp;It&rsquo;s comment describes it&rsquo;s usage.<br><br>We&rsquo;ve been generating the unverified list by subtracting matching mirror SHA512 checksums from the RubyGems list so the unverified list contains all gems that have at least one matching checksum.</span></li><li class="c6 c0"><span>Yanked gems were removed from the unverified list leaving 80 gems. These 80 gems are all prereleases and will be yanked. The authors will be emailed.<br><br>Here is the tool and files used to remove yanked gems: </span><span class="c4"><a class="c2" href="https://gist.github.com/d7e7820e6ee65d7254b2">https://gist.github.com/d7e7820e6ee65d7254b2</a></span><span><br><br>Here is the list of unverified gems: </span><span class="c4"><a class="c2" href="https://gist.github.com/raw/d7e7820e6ee65d7254b2/c96af82860203ee3ac1dd93747e24fbc7c417f92/unverified_minus_yanked.txt">https://gist.github.com/raw/d7e7820e6ee65d7254b2/c96af82860203ee3ac1dd93747e24fbc7c417f92/unverified_minus_yanked.txt</a></span></li><li class="c6 c0"><span>Validators</span></li></ol><ol class="c3" start="1"><li class="c7 c0"><span>Gem validators (code examples): </span><span class="c4"><a class="c2" href="https://gist.github.com/4a4e005b575d71c92a24">https://gist.github.com/4a4e005b575d71c92a24</a></span><span>&nbsp;</span></li><li class="c7 c0"><span>Validate your local gems against S3: </span><span class="c4"><a class="c2" href="https://gist.github.com/4678189">https://gist.github.com/4678189</a></span></li><li class="c0 c7"><span>Validate your local gems against S3 (RVM compat): </span><span class="c4"><a class="c2" href="https://gist.github.com/4678250">https://gist.github.com/4678250</a></span><span>&nbsp;</span></li><li class="c7 c0"><span>Validate your local gems against S3 (rbenv compat): </span><span class="c4"><a class="c2" href="https://gist.github.com/4679488">https://gist.github.com/4679488</a></span></li><li class="c7 c0"><span>Validate a .gem file against your installed gems: </span><span class="c4"><a class="c2" href="https://gist.github.com/4678778">https://gist.github.com/4678778</a></span></li></ol><ol class="c8" start="6"><li class="c6 c0"><span>Rubygems S3 .gem last modified dates (via curl HEAD): </span><span class="c4"><a class="c2" href="http://cl.ly/0L3M31022Q46">http://cl.ly/0L3M31022Q46</a></span></li><li class="c6 c0"><span>Rubygems Versions#created_at data: </span><span class="c4"><a class="c2" href="https://gist.github.com/4677292">https://gist.github.com/4677292</a></span></li><li class="c6 c0"><span>Original exploit gem</span></li></ol><ol class="c3" start="1"><li class="c7 c0"><span>Exploit gem (original PoC): </span><span class="c4"><a class="c2" href="https://www.dropbox.com/s/fi7r5oovqyrtacm/exploit-gems.zip">https://www.dropbox.com/s/fi7r5oovqyrtacm/exploit-gems.zip</a></span><span>&nbsp;</span></li></ol><ol class="c5" start="1"><li class="c9 c0"><span>This gem will not harm your system, but you should not install it (obviously)</span></li></ol><ol class="c3" start="2"><li class="c7 c0"><span>Exploit metadata: </span><span class="c4"><a class="c2" href="https://gist.github.com/75af5e0b071d247c08a8">https://gist.github.com/75af5e0b071d247c08a8</a></span><span>&nbsp;</span></li><li class="c7 c0"><span>Exploit gem payload: </span><span class="c4"><a class="c2" href="https://gist.github.com/3e4829f79dbd1be11295">https://gist.github.com/3e4829f79dbd1be11295</a></span></li></ol><ol class="c5" start="1"><li class="c9 c0"><span>This gem uploaded rubygems.org *.yml data to pastie.org</span></li><li class="c9 c0"><span>The attacker had the credentials contained therein</span></li></ol><h4 class="c0"><a name="h.lupn18gw9fug"></a><span>Discussion:</span></h4><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span>HN discussion: </span><span class="c4"><a class="c2" href="http://news.ycombinator.com/item?id=5139583">http://news.ycombinator.com/item?id=5139583</a></span><span>&nbsp;</span></li><li class="c6 c0"><span>Notes regarding exploit origin: </span><span class="c4"><a class="c2" href="http://news.ycombinator.com/item?id=5140100">http://news.ycombinator.com/item?id=5140100</a></span></li><li class="c6 c0"><span>IRC at #rubygems (please try not to bombard the channel with questions; the issue is being actively worked)</span></li></ol><h2 class="c0"><a name="h.vklh7bga5mlq"></a><span>What happened?</span></h2><p class="c0"><span>A user uploaded a </span><span class="c4"><a class="c2" href="https://www.dropbox.com/s/fi7r5oovqyrtacm/exploit-gems.zip">malicious gem</a></span><span>&nbsp;that contained a </span><span class="c4"><a class="c2" href="https://gist.github.com/75af5e0b071d247c08a8">malicious gem manifest</a></span><span>&nbsp;(YAML file). The manifest contained embedded Ruby with </span><span class="c4"><a class="c2" href="https://gist.github.com/3e4829f79dbd1be11295">this payload</a></span><span>. This is the only known incident involving this vulnerability, but the vulnerability involved is a remote code execution exploit, so the usual rules apply. </span></p><p class="c0 c1"><span></span></p><p class="c0"><span>The Rubygems admins turned off the ability to push new gems (to prevent further) exploits of the same vuln, and immediately started efforts to download and examine every gem manifest to rule out additional exploit gems. None were found, and efforts continued as outlined in the rest of this document.</span></p><p class="c0 c1"><span></span></p><p class="c0"><span class="c10 c17">Posts about the incident</span></p><p class="c0 c1"><span></span></p><ol class="c8" start="1"><li class="c6 c0"><span class="c4"><a class="c2" href="http://blog.newrelic.com/2013/01/30/new-relic-and-rubygems-security/">http://blog.newrelic.com/2013/01/30/new-relic-and-rubygems-security/</a></span></li><li class="c6 c0"><span class="c4"><a class="c2" href="http://blog.librato.com/2013/01/rogue-ruby-gem-can-publish-librato.html">http://blog.librato.com/2013/01/rogue-ruby-gem-can-publish-librato.html</a></span></li></ol><h2 class="c0"><a name="h.69xw1bifdepl"></a><span>Incident response recommendations</span></h2><p class="c0"><span>Note: removed anticipated/current highlighting because of indications from the Rubygems team that an infrastructure rebuild is under way. </span></p><p class="c0 c1"><span></span></p><ol class="c15" start="1"><li class="c6 c0"><span>Assume that the rubygems.org host is owned by a malicious entity</span></li></ol><ol class="c14" start="1"><li class="c7 c0"><span>Note that any work performed verifying existing gems is moot if the box is owned, and we may never know if the box is owned</span></li></ol><ol class="c15" start="2"><li class="c6 c0"><span>Consider all gems subject to tampering until the rubygems.org infrastructure has been replaced</span></li></ol><ol class="c14" start="1"><li class="c7 c0"><span>Can use S3 last modified to re-verify only gems changed since last verification</span></li></ol><ol class="c15" start="3"><li class="c6 c0"><span>Perform analysis to identify potentially altered gems</span></li></ol><ol class="c14" start="1"><li class="c7 c0"><span>Mirror cross-checking: run hashes against the .gem files on the Rubygems S3 bucket and cross-check them against other mirrors</span></li></ol><ol class="c12" start="1"><li class="c0 c9"><span>Some gem sources appear to have repacked when publishing gems, so some versions show a mismatched checksum, even though the contents are identical; workaround is to unpack gem and compare contents</span></li></ol><ol class="c14" start="2"><li class="c7 c0"><span>With the knowledge that S3 last modified time stamps cannot be altered (there is no S3 API to change them), compare to other data to identify discrepancies</span></li></ol><ol class="c12" start="1"><li class="c9 c0"><span>Rubygems data Versions#created_at should relate closely (seconds) to the S3 modified date data (qrush verified that uploads are not handled asynchronously)</span></li><li class="c9 c0"><span>PUT log data from the app should verify against S3 last modified dates; discrepancies would indicate that an out-of-band update was made to files on S3</span></li></ol><p class="c0 c1"><span></span></p><p class="c0 c1"><span></span></p></body></html>
